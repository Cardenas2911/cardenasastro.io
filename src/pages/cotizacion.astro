---
import Layout from "../layouts/Layout.astro";
import ProfileCard from "../components/ProfileCard.astro";
---

<Layout
    title="Cotizaci√≥n Inteligente de Sitios Web | Nicolas Cardenas"
    description="Calcula el precio de tu proyecto web en segundos. Desarrollo a medida, SEO y E-commerce."
    showGlobalBanner={false}
>
    <!-- Background Decor -->
    <div class="fixed inset-0 pointer-events-none z-[-1] overflow-hidden">
        <div
            class="absolute top-0 right-0 w-[500px] h-[500px] bg-gold/5 rounded-full blur-[120px] -translate-y-1/2 translate-x-1/2"
        >
        </div>
        <div
            class="absolute bottom-0 left-0 w-[500px] h-[500px] bg-neutral-900/10 dark:bg-neutral-800/20 rounded-full blur-[120px] translate-y-1/2 -translate-x-1/2"
        >
        </div>
    </div>

    <div
        class="grid grid-cols-1 lg:grid-cols-[300px_1fr] gap-8 py-8 md:py-12 max-w-7xl mx-auto px-4"
    >
        <!-- Sidebar with ProfileCard -->
        <div class="hidden lg:block w-full">
            <ProfileCard />
        </div>

        <!-- Main Content -->
        <div class="flex flex-col gap-12 min-w-0">
            <!-- Header Section with Premium Style -->
            <section
                class="relative overflow-hidden rounded-3xl bg-neutral-900 border border-white/10 p-8 md:p-12 text-center"
            >
                <div
                    class="absolute inset-0 bg-[url('https://grainy-gradients.vercel.app/noise.svg')] opacity-20"
                >
                </div>
                <!-- Subtle Gradient Glow -->
                <div
                    class="absolute -top-24 -right-24 w-64 h-64 bg-gold/10 blur-[100px] rounded-full pointer-events-none"
                >
                </div>
                <div
                    class="absolute -bottom-24 -left-24 w-64 h-64 bg-gold/5 blur-[100px] rounded-full pointer-events-none"
                >
                </div>

                <div class="relative z-10 max-w-2xl mx-auto space-y-6">
                    <h1
                        class="text-3xl md:text-5xl font-bold text-white leading-tight"
                    >
                        Cotizador de <span class="text-gold">Proyectos Web</span
                        >
                    </h1>
                    <p class="text-lg text-neutral-400 leading-relaxed">
                        Selecciona las caracter√≠sticas de tu proyecto y obt√©n
                        una estimaci√≥n de inversi√≥n inicial en tiempo real.
                    </p>
                </div>
            </section>

            <!-- Calculator Form -->
            <form id="quote-form" class="space-y-12">
                <!-- Service Type -->
                <section class="space-y-8">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-10 h-10 rounded-xl bg-gold/10 flex items-center justify-center text-gold text-xl"
                        >
                            1
                        </div>
                        <h2
                            class="text-2xl font-bold text-neutral-900 dark:text-white"
                        >
                            ¬øQu√© tipo de sitio necesitas?
                        </h2>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {/* Option: Corporativo */}
                        <label class="cursor-pointer relative group">
                            <input
                                type="radio"
                                name="serviceType"
                                value="950"
                                data-label="Sitio Corporativo"
                                class="peer sr-only"
                                checked
                            />
                            <div
                                class="p-6 rounded-2xl bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 peer-checked:border-gold dark:peer-checked:border-gold peer-checked:bg-gold/5 dark:peer-checked:bg-gold/5 hover:border-gold/50 transition-all duration-300 h-full flex flex-col items-center justify-center gap-4 text-center shadow-lg shadow-black/5 dark:shadow-black/20"
                            >
                                <div
                                    class="w-14 h-14 bg-neutral-100 dark:bg-neutral-800 rounded-full flex items-center justify-center text-2xl group-hover:scale-110 transition-transform duration-300"
                                >
                                    üíª
                                </div>
                                <div>
                                    <div
                                        class="font-bold text-neutral-900 dark:text-white text-lg"
                                    >
                                        Corporativo
                                    </div>
                                    <div
                                        class="text-sm text-neutral-500 dark:text-neutral-400 mt-1"
                                    >
                                        Para empresas y servicios
                                    </div>
                                    <div
                                        class="text-gold font-bold font-mono mt-2"
                                    >
                                        $950 USD
                                    </div>
                                </div>
                                <div
                                    class="absolute top-4 right-4 text-gold opacity-0 peer-checked:opacity-100 transition-opacity"
                                >
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="h-6 w-6"
                                        viewBox="0 0 20 20"
                                        fill="currentColor"
                                    >
                                        <path
                                            fill-rule="evenodd"
                                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                        </label>

                        {/* Option: Blog */}
                        <label class="cursor-pointer relative group">
                            <input
                                type="radio"
                                name="serviceType"
                                value="500"
                                data-label="Blog Personal"
                                class="peer sr-only"
                            />
                            <div
                                class="p-6 rounded-2xl bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 peer-checked:border-gold dark:peer-checked:border-gold peer-checked:bg-gold/5 dark:peer-checked:bg-gold/5 hover:border-gold/50 transition-all duration-300 h-full flex flex-col items-center justify-center gap-4 text-center shadow-lg shadow-black/5 dark:shadow-black/20"
                            >
                                <div
                                    class="w-14 h-14 bg-neutral-100 dark:bg-neutral-800 rounded-full flex items-center justify-center text-2xl group-hover:scale-110 transition-transform duration-300"
                                >
                                    üìù
                                </div>
                                <div>
                                    <div
                                        class="font-bold text-neutral-900 dark:text-white text-lg"
                                    >
                                        Blog / Portafolio
                                    </div>
                                    <div
                                        class="text-sm text-neutral-500 dark:text-neutral-400 mt-1"
                                    >
                                        Marca personal
                                    </div>
                                    <div
                                        class="text-gold font-bold font-mono mt-2"
                                    >
                                        $500 USD
                                    </div>
                                </div>
                                <div
                                    class="absolute top-4 right-4 text-gold opacity-0 peer-checked:opacity-100 transition-opacity"
                                >
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="h-6 w-6"
                                        viewBox="0 0 20 20"
                                        fill="currentColor"
                                    >
                                        <path
                                            fill-rule="evenodd"
                                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                        </label>

                        {/* Option: Ecommerce */}
                        <label class="cursor-pointer relative group">
                            <input
                                type="radio"
                                name="serviceType"
                                value="1300"
                                data-label="E-commerce"
                                class="peer sr-only"
                            />
                            <div
                                class="p-6 rounded-2xl bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 peer-checked:border-gold dark:peer-checked:border-gold peer-checked:bg-gold/5 dark:peer-checked:bg-gold/5 hover:border-gold/50 transition-all duration-300 h-full flex flex-col items-center justify-center gap-4 text-center shadow-lg shadow-black/5 dark:shadow-black/20"
                            >
                                <div
                                    class="w-14 h-14 bg-neutral-100 dark:bg-neutral-800 rounded-full flex items-center justify-center text-2xl group-hover:scale-110 transition-transform duration-300"
                                >
                                    üõí
                                </div>
                                <div>
                                    <div
                                        class="font-bold text-neutral-900 dark:text-white text-lg"
                                    >
                                        E-commerce
                                    </div>
                                    <div
                                        class="text-sm text-neutral-500 dark:text-neutral-400 mt-1"
                                    >
                                        Tienda en l√≠nea completa
                                    </div>
                                    <div
                                        class="text-gold font-bold font-mono mt-2"
                                    >
                                        $1,300 USD
                                    </div>
                                </div>
                                <div
                                    class="absolute top-4 right-4 text-gold opacity-0 peer-checked:opacity-100 transition-opacity"
                                >
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="h-6 w-6"
                                        viewBox="0 0 20 20"
                                        fill="currentColor"
                                    >
                                        <path
                                            fill-rule="evenodd"
                                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                        </label>

                        {/* Option: Academia */}
                        <label class="cursor-pointer relative group">
                            <input
                                type="radio"
                                name="serviceType"
                                value="1800"
                                data-label="Academia Online"
                                class="peer sr-only"
                            />
                            <div
                                class="p-6 rounded-2xl bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 peer-checked:border-gold dark:peer-checked:border-gold peer-checked:bg-gold/5 dark:peer-checked:bg-gold/5 hover:border-gold/50 transition-all duration-300 h-full flex flex-col items-center justify-center gap-4 text-center shadow-lg shadow-black/5 dark:shadow-black/20"
                            >
                                <div
                                    class="w-14 h-14 bg-neutral-100 dark:bg-neutral-800 rounded-full flex items-center justify-center text-2xl group-hover:scale-110 transition-transform duration-300"
                                >
                                    üéì
                                </div>
                                <div>
                                    <div
                                        class="font-bold text-neutral-900 dark:text-white text-lg"
                                    >
                                        LMS / Academia
                                    </div>
                                    <div
                                        class="text-sm text-neutral-500 dark:text-neutral-400 mt-1"
                                    >
                                        Cursos y membres√≠as
                                    </div>
                                    <div
                                        class="text-gold font-bold font-mono mt-2"
                                    >
                                        $1,800 USD
                                    </div>
                                </div>
                                <div
                                    class="absolute top-4 right-4 text-gold opacity-0 peer-checked:opacity-100 transition-opacity"
                                >
                                    <svg
                                        xmlns="http://www.w3.org/2000/svg"
                                        class="h-6 w-6"
                                        viewBox="0 0 20 20"
                                        fill="currentColor"
                                    >
                                        <path
                                            fill-rule="evenodd"
                                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                            clip-rule="evenodd"></path>
                                    </svg>
                                </div>
                            </div>
                        </label>
                    </div>
                </section>

                <hr class="border-neutral-200 dark:border-neutral-800" />

                <!-- Page Count -->
                <section class="space-y-8">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-10 h-10 rounded-xl bg-gold/10 flex items-center justify-center text-gold text-xl"
                        >
                            2
                        </div>
                        <h2
                            class="text-2xl font-bold text-neutral-900 dark:text-white"
                        >
                            Alcance del proyecto
                        </h2>
                    </div>

                    <div class="flex flex-col md:flex-row justify-center gap-4">
                        {/* Pill 1 */}
                        <label class="cursor-pointer w-full md:w-auto">
                            <input
                                type="radio"
                                name="pageCountPill"
                                value="0"
                                data-label="< 10 P√°ginas"
                                class="peer sr-only"
                                checked
                            />
                            <div
                                class="px-6 py-4 rounded-xl bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 peer-checked:border-gold peer-checked:text-gold peer-checked:bg-gold/5 text-neutral-600 dark:text-neutral-400 font-medium transition-all text-center hover:bg-neutral-50 dark:hover:bg-neutral-800"
                            >
                                Menos de 10
                                <span class="block text-xs opacity-60 mt-1"
                                    >Incluido</span
                                >
                            </div>
                        </label>

                        {/* Pill 2 */}
                        <label class="cursor-pointer w-full md:w-auto">
                            <input
                                type="radio"
                                name="pageCountPill"
                                value="50"
                                data-label="10 - 20 P√°ginas"
                                class="peer sr-only"
                            />
                            <div
                                class="px-6 py-4 rounded-xl bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 peer-checked:border-gold peer-checked:text-gold peer-checked:bg-gold/5 text-neutral-600 dark:text-neutral-400 font-medium transition-all text-center hover:bg-neutral-50 dark:hover:bg-neutral-800"
                            >
                                Entre 10 y 20
                                <span class="block text-xs opacity-60 mt-1"
                                    >+$50 USD</span
                                >
                            </div>
                        </label>

                        {/* Pill 3 */}
                        <label class="cursor-pointer w-full md:w-auto">
                            <input
                                type="radio"
                                name="pageCountPill"
                                value="75"
                                data-label="20 - 30 P√°ginas"
                                class="peer sr-only"
                            />
                            <div
                                class="px-6 py-4 rounded-xl bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 peer-checked:border-gold peer-checked:text-gold peer-checked:bg-gold/5 text-neutral-600 dark:text-neutral-400 font-medium transition-all text-center hover:bg-neutral-50 dark:hover:bg-neutral-800"
                            >
                                Entre 20 y 30
                                <span class="block text-xs opacity-60 mt-1"
                                    >+$75 USD</span
                                >
                            </div>
                        </label>
                    </div>
                </section>

                <hr class="border-neutral-200 dark:border-neutral-800" />

                <!-- Extras -->
                <section class="space-y-8">
                    <div class="flex items-center gap-3">
                        <div
                            class="w-10 h-10 rounded-xl bg-gold/10 flex items-center justify-center text-gold text-xl"
                        >
                            3
                        </div>
                        <h2
                            class="text-2xl font-bold text-neutral-900 dark:text-white"
                        >
                            Servicios Adicionales
                        </h2>
                    </div>

                    <div class="space-y-4 max-w-2xl mx-auto">
                        <!-- Audit -->
                        <label
                            class="group flex items-center justify-between p-5 rounded-2xl bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 cursor-pointer hover:border-gold/30 transition-all shadow-sm"
                        >
                            <div class="flex items-center gap-4">
                                <div
                                    class="w-12 h-12 rounded-full bg-neutral-100 dark:bg-neutral-800 flex items-center justify-center text-xl group-hover:text-gold transition-colors"
                                >
                                    üìä
                                </div>
                                <div>
                                    <div
                                        class="font-bold text-neutral-900 dark:text-white group-hover:text-gold transition-colors"
                                    >
                                        Auditor√≠a SEO
                                    </div>
                                    <div
                                        class="text-sm text-neutral-500 dark:text-neutral-400"
                                    >
                                        An√°lisis y estrategia inicial
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <span class="text-gold font-mono font-bold"
                                    >+$200</span
                                >
                                <div class="relative flex items-center">
                                    <input
                                        type="checkbox"
                                        name="extraAudit"
                                        value="200"
                                        class="peer sr-only"
                                    />
                                    <div
                                        class="w-11 h-6 bg-neutral-200 dark:bg-neutral-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-gold"
                                    >
                                    </div>
                                </div>
                            </div>
                        </label>

                        <!-- Positioning -->
                        <label
                            class="group flex items-center justify-between p-5 rounded-2xl bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 cursor-pointer hover:border-gold/30 transition-all shadow-sm"
                        >
                            <div class="flex items-center gap-4">
                                <div
                                    class="w-12 h-12 rounded-full bg-neutral-100 dark:bg-neutral-800 flex items-center justify-center text-xl group-hover:text-gold transition-colors"
                                >
                                    üöÄ
                                </div>
                                <div>
                                    <div
                                        class="font-bold text-neutral-900 dark:text-white group-hover:text-gold transition-colors"
                                    >
                                        Posicionamiento Web
                                    </div>
                                    <div
                                        class="text-sm text-neutral-500 dark:text-neutral-400"
                                    >
                                        Estrategia de ranking mensual
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center gap-4">
                                <span class="text-gold font-mono font-bold"
                                    >+$300</span
                                >
                                <div class="relative flex items-center">
                                    <input
                                        type="checkbox"
                                        name="extraPositioning"
                                        value="300"
                                        class="peer sr-only"
                                    />
                                    <div
                                        class="w-11 h-6 bg-neutral-200 dark:bg-neutral-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-gold"
                                    >
                                    </div>
                                </div>
                            </div>
                        </label>

                        <!-- Maintenance -->
                        <div class="space-y-4">
                            <label
                                class="group flex items-center justify-between p-5 rounded-2xl bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 cursor-pointer hover:border-gold/30 transition-all shadow-sm"
                            >
                                <div class="flex items-center gap-4">
                                    <div
                                        class="w-12 h-12 rounded-full bg-neutral-100 dark:bg-neutral-800 flex items-center justify-center text-xl group-hover:text-gold transition-colors"
                                    >
                                        üõ°Ô∏è
                                    </div>
                                    <div>
                                        <div
                                            class="font-bold text-neutral-900 dark:text-white group-hover:text-gold transition-colors"
                                        >
                                            Mantenimiento
                                        </div>
                                        <div
                                            class="text-sm text-neutral-500 dark:text-neutral-400"
                                        >
                                            Seguridad y actualizaciones
                                        </div>
                                    </div>
                                </div>
                                <div class="relative flex items-center">
                                    <input
                                        type="checkbox"
                                        id="maintenanceToggle"
                                        class="peer sr-only"
                                    />
                                    <div
                                        class="w-11 h-6 bg-neutral-200 dark:bg-neutral-700 peer-focus:outline-none rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-gold"
                                    >
                                    </div>
                                </div>
                            </label>

                            <!-- Slider -->
                            <div
                                id="maintenanceContainer"
                                class="p-6 rounded-2xl border border-dashed border-neutral-300 dark:border-neutral-700/50 bg-neutral-50 dark:bg-neutral-800/20 hidden opacity-0 transform translate-y-4 transition-all duration-500"
                            >
                                <div
                                    class="flex justify-between items-center mb-6"
                                >
                                    <label
                                        for="maintenanceMonths"
                                        class="font-medium text-neutral-700 dark:text-neutral-300"
                                        >Duraci√≥n (Meses)</label
                                    >
                                    <span
                                        class="px-3 py-1 rounded-lg bg-white dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 text-gold font-bold font-mono"
                                    >
                                        <span id="monthsDisplay">1</span> Mes(es)
                                    </span>
                                </div>
                                <input
                                    type="range"
                                    id="maintenanceMonths"
                                    min="1"
                                    max="12"
                                    value="1"
                                    class="w-full h-2 bg-neutral-200 dark:bg-neutral-700 rounded-lg appearance-none cursor-pointer accent-gold"
                                />
                                <div
                                    class="flex justify-between text-xs text-neutral-500 mt-2"
                                >
                                    <span>1 Mes</span>
                                    <span class="text-gold font-bold"
                                        >+$50 USD/mes</span
                                    >
                                    <span>12 Meses</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Spacer for fixed bar -->
                <div class="h-32"></div>
            </form>
        </div>
    </div>

    <!-- Sticky Total Bar -->
    <div
        class="fixed bottom-6 left-4 right-4 lg:left-0 lg:right-0 lg:w-fit lg:mx-auto lg:min-w-[500px] z-50"
    >
        <div
            class="bg-neutral-900 border border-gold/20 p-4 rounded-2xl shadow-2xl flex items-center justify-between gap-6 backdrop-blur-md bg-opacity-95"
        >
            <div class="flex flex-col">
                <span
                    class="text-[10px] text-neutral-400 uppercase tracking-widest font-bold"
                    >Estimado Total</span
                >
                <span class="text-2xl font-bold font-mono text-white"
                    >$<span id="totalDisplay">950</span> USD</span
                >
            </div>
            <div class="flex gap-2">
                <button
                    type="button"
                    id="download-pdf-btn"
                    class="w-10 h-10 md:w-auto md:h-auto md:px-4 md:py-2 rounded-xl bg-white/10 hover:bg-white/20 text-white transition-colors flex items-center justify-center gap-2"
                    aria-label="Descargar PDF"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        class="h-5 w-5"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"
                        ></path>
                    </svg>
                    <span class="hidden md:inline text-sm font-medium"
                        >Descargar</span
                    >
                </button>
                <button
                    id="continue-to-contact"
                    class="px-6 py-2 rounded-xl bg-gold hover:bg-gold-400 text-black font-bold transition-colors flex items-center shadow-lg shadow-gold/20 text-sm md:text-base"
                >
                    Continuar
                </button>
            </div>
        </div>
    </div>
</Layout>

<script>
    import { jsPDF } from "jspdf";

    document.addEventListener("astro:page-load", initCalculator);
    document.addEventListener("DOMContentLoaded", initCalculator);

    function initCalculator() {
        // ... (existing code) ...

        // Add listener for Continue button
        const continueBtn = document.getElementById("continue-to-contact");
        if (continueBtn) {
            continueBtn.addEventListener("click", () => {
                // Gather data
                const selectedService = document.querySelector(
                    'input[name="serviceType"]:checked',
                ) as HTMLInputElement;
                const totalDisplay = document.getElementById("totalDisplay");

                const quoteData = {
                    servicio: selectedService
                        ? selectedService.dataset.label
                        : "Desconocido",
                    totalEstimado: totalDisplay ? totalDisplay.innerText : "0",
                    fecha: new Date().toISOString(),
                };

                // Save to storage
                sessionStorage.setItem(
                    "pendingQuote",
                    JSON.stringify(quoteData),
                );

                // Go to contact
                window.location.href = "/contacto";
            });
        }

        console.log("--- initCalculator START ---");
        const form = document.getElementById("quote-form");
        if (!form) return;

        const maintenanceToggle = document.getElementById("maintenanceToggle");
        const maintenanceContainer = document.getElementById(
            "maintenanceContainer",
        );
        const maintenanceMonths = document.getElementById("maintenanceMonths");
        const monthsDisplay = document.getElementById("monthsDisplay");
        const totalDisplay = document.getElementById("totalDisplay");
        const downloadBtn = document.getElementById("download-pdf-btn");

        let currentTotal = 0;

        function calculateTotal() {
            let total = 0;

            // 1. Service Base
            const selectedService = document.querySelector(
                'input[name="serviceType"]:checked',
            ) as HTMLInputElement | null;
            if (selectedService) total += parseInt(selectedService.value) || 0;

            // 2. Page Count
            const selectedPageCount = document.querySelector(
                'input[name="pageCountPill"]:checked',
            ) as HTMLInputElement | null;
            if (selectedPageCount)
                total += parseInt(selectedPageCount.value) || 0;

            // 3. Extras
            const extraAudit = document.querySelector(
                'input[name="extraAudit"]:checked',
            ) as HTMLInputElement | null;
            if (extraAudit) total += parseInt(extraAudit.value) || 0;

            const extraPositioning = document.querySelector(
                'input[name="extraPositioning"]:checked',
            ) as HTMLInputElement | null;
            if (extraPositioning)
                total += parseInt(extraPositioning.value) || 0;

            // 4. Maintenance
            const toggleChecked =
                maintenanceToggle &&
                (maintenanceToggle as HTMLInputElement).checked;

            if (toggleChecked) {
                const months = maintenanceMonths
                    ? parseInt((maintenanceMonths as HTMLInputElement).value) ||
                      1
                    : 1;
                total += months * 50;

                // Show container
                if (maintenanceContainer) {
                    maintenanceContainer.classList.remove("hidden");
                    setTimeout(() => {
                        maintenanceContainer.classList.remove(
                            "opacity-0",
                            "translate-y-4",
                        );
                    }, 10);
                }
            } else {
                // Hide container
                if (maintenanceContainer) {
                    maintenanceContainer.classList.add(
                        "opacity-0",
                        "translate-y-4",
                    );
                    setTimeout(() => {
                        if (
                            maintenanceToggle &&
                            !(maintenanceToggle as HTMLInputElement).checked
                        ) {
                            maintenanceContainer.classList.add("hidden");
                        }
                    }, 300);
                }
            }

            // Update UI
            if (monthsDisplay && maintenanceMonths) {
                monthsDisplay.textContent = (
                    maintenanceMonths as HTMLInputElement
                ).value;
            }

            // Animate Total
            if (totalDisplay) {
                const currentDisplayed =
                    parseInt(totalDisplay.innerText.replace(/,/g, "")) || 0;
                animateValue(totalDisplay, currentDisplayed, total, 400);
            }
            currentTotal = total;
        }

        function animateValue(
            obj: HTMLElement,
            start: number,
            end: number,
            duration: number,
        ) {
            if (!obj) return;
            let startTimestamp: number | null = null;
            const step = (timestamp: number) => {
                if (!startTimestamp) startTimestamp = timestamp;
                const progress = Math.min(
                    (timestamp - startTimestamp) / duration,
                    1,
                );
                const easeProgress = 1 - Math.pow(1 - progress, 4);
                const value = Math.floor(easeProgress * (end - start) + start);
                obj.innerHTML = value.toLocaleString();
                if (progress < 1) {
                    window.requestAnimationFrame(step);
                }
            };
            window.requestAnimationFrame(step);
        }

        function generatePDF() {
            const doc = new jsPDF();
            const pageWidth = doc.internal.pageSize.getWidth();
            const centerX = pageWidth / 2;
            const goldColor = "#D9AD26";
            const blackColor = "#111111";
            const grayColor = "#666666";

            // Header
            doc.setFillColor(blackColor);
            doc.rect(0, 0, pageWidth, 40, "F");
            doc.setTextColor(goldColor);
            doc.setFontSize(22);
            doc.setFont("helvetica", "bold");
            doc.text("COTIZACI√ìN", 20, 26);
            doc.setTextColor(255, 255, 255);
            doc.setFontSize(12);
            doc.setFont("helvetica", "normal");
            doc.text("Nicolas Cardenas | Desarrollo Web", pageWidth - 20, 26, {
                align: "right",
            });

            // Date
            const date = new Date().toLocaleDateString("es-ES", {
                year: "numeric",
                month: "long",
                day: "numeric",
            });
            doc.setTextColor(grayColor);
            doc.setFontSize(10);
            doc.text(`Fecha: ${date}`, 20, 50);

            let cursorY = 70;

            // Content
            doc.setTextColor(blackColor);
            doc.setFont("helvetica", "bold");
            doc.setFontSize(14);
            doc.text("Resumen del Proyecto", 20, cursorY);
            doc.setDrawColor(200, 200, 200);
            doc.line(20, cursorY + 2, pageWidth - 20, cursorY + 2);
            cursorY += 15;

            doc.setFont("helvetica", "normal");
            doc.setFontSize(12);

            function drawRow(label, price) {
                doc.text(label, 20, cursorY);
                doc.text(price, pageWidth - 20, cursorY, { align: "right" });
                cursorY += 10;
            }

            // Items
            const selectedService = document.querySelector(
                'input[name="serviceType"]:checked',
            ) as HTMLInputElement;
            if (selectedService)
                drawRow(
                    selectedService.getAttribute("data-label") || "Servicio",
                    `$${selectedService.value}`,
                );

            const selectedPageCount = document.querySelector(
                'input[name="pageCountPill"]:checked',
            ) as HTMLInputElement;
            if (selectedPageCount) {
                const price =
                    selectedPageCount.value === "0"
                        ? "Incluido"
                        : `+$${selectedPageCount.value}`;
                drawRow(
                    selectedPageCount.getAttribute("data-label") || "P√°ginas",
                    price,
                );
            }

            const extraAudit = document.querySelector(
                'input[name="extraAudit"]:checked',
            ) as HTMLInputElement;
            if (extraAudit) drawRow("Auditor√≠a SEO", "+$200");

            const extraPositioning = document.querySelector(
                'input[name="extraPositioning"]:checked',
            ) as HTMLInputElement;
            if (extraPositioning) drawRow("Posicionamiento Web", "+$300");

            const maintenanceToggle = document.getElementById(
                "maintenanceToggle",
            ) as HTMLInputElement;
            if (maintenanceToggle && maintenanceToggle.checked) {
                const months =
                    (
                        document.getElementById(
                            "maintenanceMonths",
                        ) as HTMLInputElement
                    ).value || "1";
                const price = parseInt(months) * 50;
                drawRow(`Mantenimiento (${months} meses)`, `+$${price}`);
            }

            cursorY += 5;
            doc.setDrawColor(0, 0, 0);
            doc.setLineWidth(0.5);
            doc.line(20, cursorY, pageWidth - 20, cursorY);
            cursorY += 15;

            // Total
            doc.setFontSize(16);
            doc.setFont("helvetica", "bold");
            doc.text("TOTAL ESTIMADO (USD)", 20, cursorY);
            doc.setTextColor(goldColor);
            doc.text(
                `$${currentTotal.toLocaleString()}`,
                pageWidth - 20,
                cursorY,
                { align: "right" },
            );

            // Footer
            doc.setTextColor(grayColor);
            doc.setFontSize(8);
            doc.setFont("helvetica", "normal");
            doc.text(
                "T√©rminos: Estimaci√≥n preliminar. No constituye contrato final.",
                centerX,
                270,
                { align: "center" },
            );

            doc.save("Cotizacion-NicolasCardenas.pdf");
        }

        // Listeners
        const inputs = document.querySelectorAll("input");
        inputs.forEach((input) => {
            input.addEventListener("change", calculateTotal);
            if (input.type === "range")
                input.addEventListener("input", calculateTotal);
        });

        if (downloadBtn) downloadBtn.addEventListener("click", generatePDF);

        calculateTotal();
    }
</script>
