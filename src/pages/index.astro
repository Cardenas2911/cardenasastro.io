---
import { Image } from "astro:assets";
import Layout from "../layouts/Layout.astro";
import ProfileCard from "../components/ProfileCard.astro";
import SkillsCarousel from "../components/SkillsCarousel.astro";

import { getCollection } from "astro:content";

const allPosts = await getCollection("blog");
const posts = allPosts
    .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
    .slice(0, 9);
// Show latest 9 posts in carousel
---

<Layout title="Nicolas Cardenas - Experto en WordPress y SEO">
    <div class="grid grid-cols-1 lg:grid-cols-[300px_1fr] gap-8">
        <!-- Sidebar -->
        <div class="hidden lg:block">
            <ProfileCard />
        </div>

        <!-- Main Content -->
        <div class="space-y-12 min-w-0">
            <!-- Hero Section -->
            <section
                class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-3xl p-8 md:p-12 relative overflow-hidden transition-colors duration-300"
            >
                <div
                    class="absolute top-0 right-0 w-64 h-64 bg-gold/5 dark:bg-gold/10 rounded-full blur-3xl -translate-y-1/2 translate-x-1/2"
                >
                </div>

                <div class="relative z-10">
                    <div
                        class="inline-block px-4 py-1.5 rounded-full bg-neutral-100 dark:bg-neutral-800 border border-neutral-200 dark:border-neutral-700 text-gold text-sm font-medium mb-6 transition-colors"
                    >
                        üëã Hola, bienvenido a mi portafolio
                    </div>
                    <h1
                        class="text-4xl md:text-5xl font-bold text-neutral-900 dark:text-white mb-6 leading-tight transition-colors"
                    >
                        Especialista en <span class="text-gold">WordPress</span
                        >,<br />
                        SEO y Consultor√≠a Digital<br />
                        en Medell√≠n
                    </h1>
                    <p
                        class="text-neutral-600 dark:text-neutral-400 text-lg max-w-2xl mb-8 transition-colors"
                    >
                        Ayudo a negocios a escalar su presencia digital con
                        arquitecturas web s√≥lidas y estrategias de
                        posicionamiento org√°nico efectivas.
                    </p>
                    <div class="flex flex-wrap gap-4">
                        <a
                            href="/servicios"
                            class="px-6 py-3 bg-gold text-black font-bold rounded-xl hover:bg-gold-400 transition-colors shadow-lg shadow-gold/20"
                        >
                            Mis Servicios
                        </a>
                        <a
                            href="/contacto"
                            class="px-6 py-3 bg-neutral-100 dark:bg-neutral-800 text-neutral-900 dark:text-white font-medium rounded-xl hover:bg-neutral-200 dark:hover:bg-neutral-700 transition-colors border border-neutral-200 dark:border-neutral-700"
                        >
                            Hablemos
                        </a>
                    </div>
                </div>
            </section>

            <!-- Skills Section (Infinite Carousel) -->
            <section class="overflow-hidden">
                <div class="flex items-center gap-4 mb-8">
                    <div
                        class="h-px flex-1 bg-neutral-200 dark:bg-neutral-800 transition-colors"
                    >
                    </div>
                    <h2
                        class="text-2xl font-bold text-neutral-900 dark:text-white flex items-center gap-2 transition-colors"
                    >
                        <span class="text-gold">‚ö°</span> Mis Habilidades
                    </h2>
                    <div
                        class="h-px flex-1 bg-neutral-200 dark:bg-neutral-800 transition-colors"
                    >
                    </div>
                </div>

                <SkillsCarousel />
            </section>

            <!-- Services Preview -->
            <section>
                <div class="flex items-center gap-4 mb-8">
                    <div
                        class="h-px flex-1 bg-neutral-200 dark:bg-neutral-800 transition-colors"
                    >
                    </div>
                    <h2
                        class="text-2xl font-bold text-neutral-900 dark:text-white flex items-center gap-2 transition-colors"
                    >
                        <span class="text-gold">üíº</span> Servicios que brindo
                    </h2>
                    <div
                        class="h-px flex-1 bg-neutral-200 dark:bg-neutral-800 transition-colors"
                    >
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div
                        class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 p-6 rounded-2xl hover:-translate-y-1 transition-all duration-300"
                    >
                        <div
                            class="w-12 h-12 bg-neutral-100 dark:bg-neutral-800 rounded-lg flex items-center justify-center text-2xl mb-4 text-gold transition-colors"
                        >
                            üíª
                        </div>
                        <h3
                            class="text-lg font-bold text-neutral-900 dark:text-white mb-2 transition-colors"
                        >
                            Desarrollo Web
                        </h3>
                        <p
                            class="text-neutral-600 dark:text-neutral-400 text-sm transition-colors"
                        >
                            Sitios r√°pidos y modernos con WordPress o Astro.
                        </p>
                    </div>
                    <div
                        class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 p-6 rounded-2xl hover:-translate-y-1 transition-all duration-300"
                    >
                        <div
                            class="w-12 h-12 bg-neutral-100 dark:bg-neutral-800 rounded-lg flex items-center justify-center text-2xl mb-4 text-gold transition-colors"
                        >
                            üöÄ
                        </div>
                        <h3
                            class="text-lg font-bold text-neutral-900 dark:text-white mb-2 transition-colors"
                        >
                            SEO Avanzado
                        </h3>
                        <p
                            class="text-neutral-600 dark:text-neutral-400 text-sm transition-colors"
                        >
                            Auditor√≠as y estrategias para rankear en Google.
                        </p>
                    </div>
                    <div
                        class="bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 p-6 rounded-2xl hover:-translate-y-1 transition-all duration-300"
                    >
                        <div
                            class="w-12 h-12 bg-neutral-100 dark:bg-neutral-800 rounded-lg flex items-center justify-center text-2xl mb-4 text-gold transition-colors"
                        >
                            üõçÔ∏è
                        </div>
                        <h3
                            class="text-lg font-bold text-neutral-900 dark:text-white mb-2 transition-colors"
                        >
                            E-commerce
                        </h3>
                        <p
                            class="text-neutral-600 dark:text-neutral-400 text-sm transition-colors"
                        >
                            Tiendas online que venden solas.
                        </p>
                    </div>
                </div>
            </section>

            <!-- Blog Section -->
            <section>
                <div class="flex items-center gap-4 mb-8">
                    <div
                        class="h-px flex-1 bg-neutral-200 dark:bg-neutral-800 transition-colors"
                    >
                    </div>
                    <h2
                        class="text-2xl font-bold text-neutral-900 dark:text-white flex items-center gap-2 transition-colors"
                    >
                        <span class="text-gold">üìä</span> Noticias y Actualizaciones
                    </h2>
                    <div
                        class="h-px flex-1 bg-neutral-200 dark:bg-neutral-800 transition-colors"
                    >
                    </div>
                </div>

                <div class="relative">
                    <!-- Carousel Container -->
                    <div class="overflow-hidden" id="blog-carousel">
                        <div
                            class="flex gap-6 transition-transform duration-500 ease-out"
                            id="blog-carousel-track"
                        >
                            {
                                posts.map((post) => (
                                    <article class="min-w-[calc(100%-0px)] md:min-w-[calc(50%-12px)] lg:min-w-[calc(33.333%-16px)] bg-white dark:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 rounded-2xl overflow-hidden hover:shadow-xl hover:shadow-gold/5 transition-all group flex-shrink-0">
                                        {post.data.heroImage && (
                                            <div class="aspect-video overflow-hidden">
                                                <Image
                                                    src={post.data.heroImage}
                                                    alt={post.data.title}
                                                    width={600}
                                                    height={338}
                                                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                                                />
                                            </div>
                                        )}
                                        <div class="p-6">
                                            <h3 class="text-lg font-bold text-neutral-900 dark:text-white mb-3 line-clamp-2 group-hover:text-gold transition-colors">
                                                <a
                                                    href={`/blog/${post.slug.replace(/\.[^/.]+$/, "")}`}
                                                >
                                                    {post.data.title}
                                                </a>
                                            </h3>
                                            <p class="text-neutral-600 dark:text-neutral-400 text-sm line-clamp-3 mb-4 transition-colors">
                                                {post.data.description}
                                            </p>
                                            <a
                                                href={`/blog/${post.slug.replace(/\.[^/.]+$/, "")}`}
                                                class="inline-flex items-center text-gold text-sm font-medium hover:gap-2 transition-all"
                                            >
                                                Leer m√°s <span>‚Üí</span>
                                            </a>
                                        </div>
                                    </article>
                                ))
                            }
                        </div>
                    </div>

                    <!-- Navigation Buttons -->
                    <button
                        id="prev-btn"
                        class="absolute left-2 md:-left-5 top-1/2 -translate-y-1/2 bg-white/80 dark:bg-neutral-900/80 md:bg-white dark:md:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 text-neutral-900 dark:text-white p-3 rounded-full hover:bg-neutral-100 dark:hover:bg-neutral-800 hover:border-gold transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed z-10 backdrop-blur-sm md:backdrop-blur-none"
                        aria-label="Previous"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-6 w-6"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M15 19l-7-7 7-7"></path>
                        </svg>
                    </button>
                    <button
                        id="next-btn"
                        class="absolute right-2 md:-right-5 top-1/2 -translate-y-1/2 bg-white/80 dark:bg-neutral-900/80 md:bg-white dark:md:bg-neutral-900 border border-neutral-200 dark:border-neutral-800 text-neutral-900 dark:text-white p-3 rounded-full hover:bg-neutral-100 dark:hover:bg-neutral-800 hover:border-gold transition-all shadow-lg disabled:opacity-50 disabled:cursor-not-allowed z-10 backdrop-blur-sm md:backdrop-blur-none"
                        aria-label="Next"
                    >
                        <svg
                            xmlns="http://www.w3.org/2000/svg"
                            class="h-6 w-6"
                            fill="none"
                            viewBox="0 0 24 24"
                            stroke="currentColor"
                        >
                            <path
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                stroke-width="2"
                                d="M9 5l7 7-7 7"></path>
                        </svg>
                    </button>
                </div>

                <script>
                    const track = document.getElementById(
                        "blog-carousel-track",
                    );
                    const prevBtn = document.getElementById(
                        "prev-btn",
                    ) as HTMLButtonElement | null;
                    const nextBtn = document.getElementById(
                        "next-btn",
                    ) as HTMLButtonElement | null;

                    let currentIndex = 0;
                    const getItemsPerView = () => {
                        if (window.innerWidth >= 1024) return 3;
                        if (window.innerWidth >= 768) return 2;
                        return 1;
                    };

                    const totalItems = track?.children.length || 0;

                    const updateCarousel = () => {
                        const itemsPerView = getItemsPerView();
                        const maxIndex = Math.max(0, totalItems - itemsPerView);
                        currentIndex = Math.min(currentIndex, maxIndex);

                        const itemWidth =
                            (track?.children[0] as HTMLElement)?.offsetWidth ||
                            0;
                        const gap = 24; // 6 * 4px (gap-6)
                        const offset = -(currentIndex * (itemWidth + gap));

                        if (track) {
                            track.style.transform = `translateX(${offset}px)`;
                        }

                        // Update button states
                        if (prevBtn) prevBtn.disabled = currentIndex === 0;
                        if (nextBtn)
                            nextBtn.disabled = currentIndex >= maxIndex;
                    };

                    prevBtn?.addEventListener("click", () => {
                        if (currentIndex > 0) {
                            currentIndex--;
                            updateCarousel();
                        }
                    });

                    nextBtn?.addEventListener("click", () => {
                        const itemsPerView = getItemsPerView();
                        const maxIndex = Math.max(0, totalItems - itemsPerView);
                        if (currentIndex < maxIndex) {
                            currentIndex++;
                            updateCarousel();
                        }
                    });

                    // Update on resize
                    window.addEventListener("resize", updateCarousel);

                    // Initial update
                    updateCarousel();
                </script>
            </section>
        </div>
    </div>
</Layout>
